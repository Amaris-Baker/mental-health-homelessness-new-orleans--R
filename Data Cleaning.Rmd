---
title: "Mental Health Data"
author: "Amaris Baker"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r r setup, include=FALSE}
# Load necessary packages
library(dplyr)
library(stringr)
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

``` {r loading data set}
# Load dataset (make sure CSV is in the same folder as this Rmd file)
#Dataset not attached for HIPPA Purposes
Survey <- read.csv("HTC Mental Health.csv")

# Inspect

head(Survey)
names(Survey)

# Remove unwanted rows/columns

Survey <- Survey[-c(1:2), -c(1:18)]
Survey <- Survey[-c(88), ]
```
```{r Gender}
#Create and Clean Gender Variable
unique(Survey$Q3)
Survey <- Survey %>%
  mutate(gender = case_when(
    Q3 == "Female" ~ 1,
    Q3 == "Male" ~ 2,
    Q3 == "Other (please specify)"& !is.na(Q4) ~ 3, 
    TRUE ~ NA_real_
  ))
table(Survey$gender, useNA = "ifany")
# 17 female, 82 males, 1 other (bisexual)
```

```{r Ethnicity}
#Create and Clean Ethnicity Variable
unique (Survey$Q61)
Survey <- Survey %>%
  mutate(ethnicity = case_when(
    Q61 == "Hispanic or Latino" ~ 1,
    Q61 == "Non Hispanic or Latino" ~ 2,
    Q61 == "Prefer not to say" ~ 3, 
    TRUE ~ NA_real_
  ))
table(Survey$ethnicity, useNA = "ifany")
# 15 Hispanic or Latino, 80 Non Hispanic or Latino, 5 Prefer Not to answer
```


```{r Race}
# Create and clean race variables

Survey <- Survey %>%
mutate(
race = if_else(is.na(Q5), "", Q5),
race_white = if_else(str_detect(race, fixed("White")), 1L, 0L),
race_black = if_else(str_detect(race, fixed("Black or African American")), 1L, 0L),
race_ai_an = if_else(str_detect(race, fixed("American Indian or Alaska Native")), 1L, 0L),
race_asian = if_else(str_detect(race, fixed("Asian")), 1L, 0L),
race_prefer_not = if_else(str_detect(race, fixed("Prefer not to say")), 1L, 0L),
race_other = if_else(
str_detect(race, fixed("Other (please specify)")) & !is.na(Q6) & Q6 != "",
1L,
0L
),
race_num_selected = race_white + race_black + race_ai_an + race_asian + race_other + race_prefer_not,
race_multiracial = if_else(race_num_selected > 1 & race_prefer_not == 0L, 1L, 0L),
race_single = if_else(race_num_selected == 1L, 1L, 0L),
race_category = case_when(
race_prefer_not == 1L ~ "Prefer not to say",
race_multiracial == 1L ~ "Multiracial",
race_white == 1L ~ "White",
race_black == 1L ~ "Black or African American",
race_ai_an == 1L ~ "American Indian or Alaska Native",
race_asian == 1L ~ "Asian",
race_other == 1L ~ "Other",
TRUE ~ NA_character_
)
)

# Check the distribution

table(Survey$race_category, useNA = "ifany")
# Explicit count of Multiracial respondents
num_multiracial <- sum(Survey$race_multiracial == 1L, na.rm = TRUE)
num_multiracial

race_counts <- c(
  White = sum(Survey$race_white, na.rm = TRUE),
  Black_or_African_American = sum(Survey$race_black, na.rm = TRUE),
  American_Indian_or_Alaska_Native = sum(Survey$race_ai_an, na.rm = TRUE),
  Asian = sum(Survey$race_asian, na.rm = TRUE),
  Other = sum(Survey$race_other, na.rm = TRUE),
  Prefer_not_to_say = sum(Survey$race_prefer_not, na.rm = TRUE)
)
race_counts
# 44 Black or African American, 43 White, 7 other (2 Cuban, 1 Creole, 1 Hispanic, 1 Mexican, 1 Horse, 1 Human), 2 American Indian or Alaska Native, 1 Asian, 1 Prefer not to say, 2 multiracial
# The multiracial- 45 black and 44 white 3 American Indian or Alaska Native, 8 other 
```

```{r Time Homeless}
# Create Categories for How Long people have been experiencing homelessness
unique(Survey$Q7)
Survey <- Survey %>%
  mutate(time_homeless = case_when(
    Q7 == "Less than 6 months" ~ 1,
    Q7 == "6 months to less than 1 year" ~ 2,
    Q7 == "1 to 3 years" ~ 3, 
    Q7 == "More than 3 years" ~4,
    TRUE ~ NA_real_
  ))
table(Survey$time_homeless, useNA = "ifany")
# 26 less than 6 months, 11 6 months to less than a year, 33 1 to 3 years, 30 more than 3 years
```

```{r Age}
# Creating age groups
Survey <- Survey %>%
  mutate(age = 2025 - as.numeric(Q1))
summary(Survey$age)
Survey <- Survey %>%
  mutate(age_group = case_when(
    age < 30 ~ "<30",
    age >= 30 & age < 45 ~ "30–44",
    age >= 45 & age < 60 ~ "45–59",
    age >= 60 ~ "60+",
    TRUE ~ NA_character_
  ))
unique(Survey$age_group)
table(Survey$age_group)
#4 People are less than 30, 33 people are between 30-44, 39 people are between 45-59, and 24 are older than 60
```

```{r Sleep Settings}
# Sleep Settings
Survey <- Survey %>%
  mutate(sleep_setting = case_when(
    Q8 == "Shelter" ~ "1",
    Q8 == "Outdoors (encampment, tent, library, park, etc.)" ~ "2",
    Q8 == "Other (please specify)" ~ "3",
    Q8 == "Car" ~ "4",
    TRUE ~ NA_character_
  ))
table (Survey$ sleep_setting)
# 33 people stay in Shelters, 60 people stay Outdoors (encampment, tent, library, park, etc.), 1 in a car, 6 other(1 Couch surfing, 1 Housesitting, 1 Shelter and Hotel, 1 Shelter and Outdoors, 1 Shelter and sometimes outside, 1 Someday outdoors and someday shelter.)
```

```{r Substance Use}
#Substance Use
Survey <- Survey %>%
  mutate(tobacco_use = case_when(
    Q49== "Yes"~1,
    Q49== "No"~2,
    TRUE~ NA_real_
  ))
table(Survey$ tobacco_use)
# 77 yes, 23 no
Survey <- Survey %>%
  mutate(alcohol_use = case_when(
    Q50== "Yes"~1,
    Q50== "No"~2,
    TRUE~ NA_real_
  ))
table(Survey$ alcohol_use)
# 50 yes, 50 no
Survey <- Survey %>%
  mutate(other_drug_use = case_when(
    Q51== "Yes"~1,
    Q51== "No"~2,
    TRUE~ NA_real_
  ))
table(Survey$ other_drug_use)
# 46 yes, 54 no
Survey <- Survey %>%
  mutate(
    tobacco_flag = if_else(Q49 == "Yes", 1, 0),
    alcohol_flag = if_else(Q50 == "Yes", 1, 0),
    drug_flag = if_else(Q51 == "Yes", 1, 0)
  )
Survey <- Survey %>%
  mutate(any_substance_use = if_else(
    Q49 == "Yes" | Q50 == "Yes" | Q51 == "Yes", 1, 0
  ))
table (Survey$any_substance_use)

#85 participants used at least one substance in the past month
#15 participants did not use at least one substance in the past month
```

```{r Mental Health Diagnosis}
#Mental Health Diagnosis- multiselect
unique (Survey$Q12)

has_q13 <- "Q13" %in% names(Survey)
Survey <- Survey %>%
  mutate(
    meantal_illness = if_else(is.na(Q12), "", Q12),
    mh_depression = if_else(str_detect(meantal_illness, fixed("Depression")), 1L, 0L),
    mh_anxiety = if_else(str_detect(meantal_illness, fixed("Anxiety disorder")), 1L, 0L),
    mh_bipolar = if_else(str_detect(meantal_illness, fixed("Bipolar disorder")), 1L, 0L),
    mh_schizophrenia = if_else(str_detect(meantal_illness, fixed("Schizophrenia")), 1L, 0L),
    mh_ptsd = if_else(str_detect(meantal_illness, fixed("PTSD (post traumatic stress disorder)")), 1L, 0L),
    mh_prefer_not = if_else(str_detect(meantal_illness, fixed("Prefer not to say")), 1L, 0L),
    mh_other = if_else(str_detect(meantal_illness, fixed("Other (please specify)")), 1L, 0L),
    mh_num_selected = mh_depression + mh_anxiety + mh_bipolar + mh_schizophrenia + mh_ptsd + mh_other + mh_prefer_not,
    mh_multiple = if_else(mh_num_selected > 1 & mh_prefer_not == 0L, 1L, 0L),
    mh_single = if_else(mh_num_selected == 1L, 1L, 0L),
    mh_category = case_when(
      mh_prefer_not == 1L ~ "Prefer not to say",
      mh_multiple == 1L ~ "Multiple",
      mh_depression == 1L ~ "Depression",
      mh_anxiety == 1L ~ "Anxiety disorder",
      mh_bipolar == 1L ~ "Bipolar disorder",
      mh_schizophrenia == 1L ~ "Schizophrenia",
      mh_ptsd == 1L ~ "PTSD",
      mh_other == 1L ~ "Other",
      TRUE ~ NA_character_
    ),
    mh_other_detail = case_when(
      has_q13 & !is.na(Q13) & Q13 != "" ~ Q13,
      TRUE ~ NA_character_
    )
  )

# Exclusive categories (each person counted once)
table(Survey$mh_category, useNA = "ifany")

# Explicit count of Multiple respondents
num_mh_multiple <- sum(Survey$mh_multiple == 1L, na.rm = TRUE)
num_mh_multiple

# Any-selection counts (people selecting multiple are counted in each selected condition)
mh_counts <- c(
  Depression = sum(Survey$mh_depression, na.rm = TRUE),
  Anxiety_disorder = sum(Survey$mh_anxiety, na.rm = TRUE),
  Bipolar_disorder = sum(Survey$mh_bipolar, na.rm = TRUE),
  Schizophrenia = sum(Survey$mh_schizophrenia, na.rm = TRUE),
  PTSD = sum(Survey$mh_ptsd, na.rm = TRUE),
  Other = sum(Survey$mh_other, na.rm = TRUE),
  Prefer_not_to_say = sum(Survey$mh_prefer_not, na.rm = TRUE)
)
mh_counts
#69 people have more than one mental health diagnosis :The totals are as follows   Depression-70  Anxiety_disorder-50  Bipolar_disorder-41    Schizophrenia-21   PTSD-38   Other-27   Prefer_not_to_say-1 

# Q13
unique(Survey$Q13)
Survey <- Survey %>%
  mutate(
    mh_other_detail_clean = case_when(
      has_q13 & !is.na(Q13) & Q13 != "" ~ str_squish(str_to_lower(Q13)),
      TRUE ~ NA_character_
    ),
    mh_other_detail_category = case_when(
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "adhd|attention[- ]?deficit|hyperactiv") ~ "ADHD",
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "ocd|obsessive[- ]?compulsive") ~ "OCD",
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "panic|agoraphob") ~ "Panic/agoraphobia",
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "(social )?anxiety|gad|generalized anxiety") ~ "Anxiety (text)",
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "depress") ~ "Depression (text)",
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "ptsd|post[- ]?traumatic|cptsd|trauma") ~ "PTSD/Trauma (text)",
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "schizoaffective") ~ "Schizoaffective",
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "autism|asd|asperger") ~ "Autism spectrum",
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "bpd|borderline|personality disorder") ~ "Personality disorder",
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "(eating )?disorder|anorex|bulimi|binge") ~ "Eating disorder",
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "insomnia|sleep|circadian") ~ "Sleep disorder",
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "substance|alcohol|drug use") ~ "Substance use (text)",
      !is.na(mh_other_detail_clean) & str_detect(mh_other_detail_clean, "grief|bereave") ~ "Grief/bereavement",
      !is.na(mh_other_detail_clean) & mh_other_detail_clean != "" ~ "Other/unspecified",
      TRUE ~ NA_character_
    )
  )

# Frequency of categorized Other (restricted to those who selected Other in Q12)
table(Survey$mh_other_detail_category[Survey$mh_other == 1], useNA = "ifany")
```

```{r Length of Mental Health Diagnosis}
# How long have people had these diagnosis
mh_dur_code <- function(x) {
  case_when(
    x == "Less than 1 year" ~ 1L,
    x == "1 to less than 3  years" | x == "1 to less than 3 years" ~ 2L,
    x == "3 to less than 5 years" ~ 3L,
    x == "More than 5 years" ~ 4L,
    x == "Not sure/prefer not to say" ~ 5L,
    TRUE ~ NA_integer_
  )
}

mh_dur_label <- function(code) {
  case_when(
    code == 1L ~ "<1 year",
    code == 2L ~ "1–<3 years",
    code == 3L ~ "3–<5 years",
    code == 4L ~ ">5 years",
    code == 5L ~ "Not sure/prefer not",
    TRUE ~ NA_character_
  )
}

# Duration of diagnosis per condition (Q52–Q56, Q58)
# Coding: 1 <1yr, 2 1–<3yr, 3 3–<5yr, 4 >5yr, 5 Not sure/prefer not
Survey <- Survey %>%
  mutate(
    mh_depression_duration = mh_dur_code(Q52),
    mh_depression_duration_label = mh_dur_label(mh_depression_duration),
    mh_anxiety_duration = mh_dur_code(Q53),
    mh_anxiety_duration_label = mh_dur_label(mh_anxiety_duration),
    mh_bipolar_duration = mh_dur_code(Q54),
    mh_bipolar_duration_label = mh_dur_label(mh_bipolar_duration),
    mh_schizophrenia_duration = mh_dur_code(Q55),
    mh_schizophrenia_duration_label = mh_dur_label(mh_schizophrenia_duration),
    mh_ptsd_duration = mh_dur_code(Q56),
    mh_ptsd_duration_label = mh_dur_label(mh_ptsd_duration),
    mh_other_duration = mh_dur_code(Q58),
    mh_other_duration_label = mh_dur_label(mh_other_duration)
  )

# Duration tables (restricted to those who selected the condition)
table(Survey$mh_depression_duration_label[Survey$mh_depression == 1], useNA = "ifany")
table(Survey$mh_anxiety_duration_label[Survey$mh_anxiety == 1], useNA = "ifany")
table(Survey$mh_bipolar_duration_label[Survey$mh_bipolar == 1], useNA = "ifany")
table(Survey$mh_schizophrenia_duration_label[Survey$mh_schizophrenia == 1], useNA = "ifany")
table(Survey$mh_ptsd_duration_label[Survey$mh_ptsd == 1], useNA = "ifany")
table(Survey$mh_other_duration_label[Survey$mh_other == 1], useNA = "ifany")

# Depression: <1 year-1    1-<3 years-4    3<5years-5   >5years-62

# Anxiety: <1 year-2    1-<3 years-5    3<5years-3   >5years-40

# Bipolar: <1 year-0    1-<3 years-3   3<5years-1   >5years-36  Not sure/prefer not-1

# Schizophrenia: <1 year-0    1-<3 years-3    3<5years-2   >5years-16

# PTSD: <1 year-1   1-<3 years-3    3<5years-2   >5years-32

# Other: <1 year-0    1-<3 years-0    3<5years-2  >5years-24 Not sure/prefer not-1
```

```{r Recieving Access to Care in the Past Year}
#Receiving Access in the past year
unique(Survey$Q15)
Survey <- Survey %>%
  mutate(accessed_care = case_when(
    Q15== "Yes"~1,
    Q15== "No"~2,
    TRUE~ NA_real_
  ))
table(Survey$ accessed_care)
#68 people have received care in the past year and 32 have not
```

```{r Not Recieving Care in the Past Year}
#Those who did not receive care in the past year
unique(Survey$Q30)
Survey <- Survey %>%
  mutate(time_without_care = case_when(
    Q30 == "1 to less than 3 years ago"  ~ 1,
    Q30== "3 to less than 5 years ago"  ~ 2,
    Q30== "More than 5 years ago" ~ 3, 
    Q30== "Not sure/prefer not to say" ~4,
    TRUE ~ NA_real_
  ))
table(Survey$time_without_care, useNA = "ifany")

#10-1 to less than 3 years ago  5-3 to less than 5 years ago     13-More than 5 years ago    4-Not sure/prefer not to say

# For the following all the following data cleaning the sample size is the 68 people who have received mental health care within the past year
```

```{r Where was care recieved}
unique(Survey$Q16)
Survey <- Survey %>%
  mutate(
    provider = if_else(is.na(Q16), "", Q16),
    MHSD = if_else(str_detect(provider, fixed("MHSD (Metropolitan Human Services District)" )), 1L, 0L),
    CC = if_else(str_detect(provider, fixed("Crescent Care")), 1L, 0L),
    Start_Corp = if_else(str_detect(provider, fixed("Start Corp")), 1L, 0L),
    RDH = if_else(str_detect(provider, fixed("RHD (Resources for Human Development)")), 1L, 0L),
    Odyssey = if_else(str_detect(provider, fixed("Odyssey House")), 1L, 0L),
    UMC = if_else(str_detect(provider, fixed("University Medical Center")), 1L, 0L),
    Not_sure_provider = if_else(str_detect(provider, fixed("Not sure")), 1L, 0L),
    other_provider = if_else(str_detect(provider, fixed("Other (please specify)")), 1L, 0L),
    provider_num_selected = MHSD + CC + Start_Corp + RDH + Odyssey + UMC + Not_sure_provider + other_provider,
    provider_multiple = if_else(provider_num_selected > 1 & other_provider == 0L, 1L, 0L),
    provider_single = if_else(provider_num_selected == 1L, 1L, 0L),
    provider_category = case_when(
      Not_sure_provider == 1L ~ "Not Sure",
      provider_multiple == 1L ~ "Multiple",
      other_provider == 1L ~ "Other",
      CC == 1L ~ "Crescent Care",
      Start_Corp == 1L ~ "Start Corp",
      UMC == 1L ~ "University Medical Center",
      RDH == 1L ~ "RHD",
      MHSD == 1L ~ "MHSD",
      Odyssey == 1L ~ "Odyssey",
      TRUE ~ NA_character_
    )
  )

table(Survey$provider_category, useNA = "ifany")

num_provider_multiple <- sum(Survey$provider_multiple == 1L, na.rm = TRUE)
num_provider_multiple

# Any-selection counts (people selecting multiple are counted in each selected provider)
provider_counts <- c(
  MHSD = sum(Survey$MHSD, na.rm = TRUE),
  Crescent_Care = sum(Survey$CC, na.rm = TRUE),
  Start_Corp = sum(Survey$Start_Corp, na.rm = TRUE),
  RHD = sum(Survey$RDH, na.rm = TRUE),
  Odyssey_House = sum(Survey$Odyssey, na.rm = TRUE),
  University_Medical_Center = sum(Survey$UMC, na.rm = TRUE),
  Not_Sure = sum(Survey$Not_sure_provider, na.rm = TRUE),
  Other = sum(Survey$other_provider, na.rm = TRUE)
)
provider_counts

has_q17 <- "Q17" %in% names(Survey)
Survey <- Survey %>%
  mutate(
    provider_other_detail_clean = case_when(
      has_q17 & !is.na(Q17) & Q17 != "" ~ str_squish(str_to_lower(Q17)),
      TRUE ~ NA_character_
    ),
    provider_other_detail_category = case_when(
      !is.na(provider_other_detail_clean) & str_detect(provider_other_detail_clean, "jail|prison|incarcerat|sheriff|department of correction|doc") ~ "Jail/Prison",
      !is.na(provider_other_detail_clean) & str_detect(provider_other_detail_clean, "telehealth|tele[- ]?medicine|virtual|video visit|phone visit|telehealth") ~ "Telehealth",
      !is.na(provider_other_detail_clean) & str_detect(provider_other_detail_clean, "miami|nashville|shreveport|\\btx\\b|texas|\\bms\\b|mississippi|\\bfl\\b|florida|\\bga\\b|georgia|\\bal\\b|alabama|pa|pennsylvania|out of state|out-of-state|another state|different state") ~ "Out of state",
      !is.na(provider_other_detail_clean) & str_detect(provider_other_detail_clean, "va|veterans|v\\.a\\.|theva|va hospital") ~ "VA",
      !is.na(provider_other_detail_clean) & str_detect(provider_other_detail_clean, "tulane|lsu|university|college|teaching clinic|student clinic") ~ "University Clinic",
      !is.na(provider_other_detail_clean) & str_detect(provider_other_detail_clean, "charity|oschner|north lake|saint charles|hospital|er|e\\.r\\.|emergency room|emergency department|ed") ~ "Hospital",
      !is.na(provider_other_detail_clean) & str_detect(provider_other_detail_clean, "oz|rebuild|odyssey|oceans|river oaks|covington|brentwood|jphsa|unity|peoples health|essential care|gulf coast|nami|beron street|new orleans mission") ~ "Behavioral Health Center",
      !is.na(provider_other_detail_clean) & str_detect(provider_other_detail_clean, "private|cash|out[- ]?of[- ]?pocket|self[- ]?pay|psychologist|psychiatrist|friend|social support") ~ "Private/Informal",
      !is.na(provider_other_detail_clean) & str_detect(provider_other_detail_clean, "church|faith|ministry|pastor|chaplain") ~ "Faith-based org",
      !is.na(provider_other_detail_clean) & str_detect(provider_other_detail_clean, "mobile|street|outreach|van") ~ "Mobile/Outreach",
      !is.na(provider_other_detail_clean) & str_detect(provider_other_detail_clean, "can't remember|don't remember|not sure") ~ "Can't remember",
      !is.na(provider_other_detail_clean) & provider_other_detail_clean != "" ~ "Other/unspecified",
      TRUE ~ NA_character_
    )
  )

# Frequency of categorized Other providers (restricted to those who selected Other)
table(Survey$provider_other_detail_category[Survey$other_provider == 1], useNA = "ifany")
#Behavioral Health Center-5                Hospital-14             Jail/Prison-3        Other/unspecified-2           Out of state-5  Telehealth-1        University Clinic-4              VA-3
```

```{r Mental Healthcare Services Accessed}
unique(Survey$Q18)
Survey <- Survey %>%
  mutate(
    services = if_else(is.na(Q18), "", Q18),
    act_team = if_else(str_detect(services, fixed("ACT Team (Assertive Community Treatment)")), 1L, 0L),
    therapy = if_else(str_detect(services, fixed("Therapy or counseling")), 1L, 0L),
    er_services = if_else(str_detect(services, fixed("Emergency Room")), 1L, 0L),
    inpatient_voluntary = if_else(str_detect(services, fixed("Inpatient hospitalization- voluntary")), 1L, 0L),
    inpatient_involuntary = if_else(str_detect(services, fixed("Inpatient hospitalization- involuntary")), 1L, 0L),
    medication_mgmt = if_else(str_detect(services, fixed("Medication management")), 1L, 0L),
    outpatient_program = if_else(str_detect(services, fixed("Outpatient program")), 1L, 0L),
    services_prefer_not = if_else(str_detect(services, fixed("Prefer not to say")), 1L, 0L),
    services_other = if_else(str_detect(services, fixed("Other (please specify)")), 1L, 0L),
    services_num_selected = act_team + therapy + er_services + inpatient_voluntary + inpatient_involuntary + medication_mgmt + outpatient_program + services_other + services_prefer_not,
    services_multiple = if_else(services_num_selected > 1 & services_prefer_not == 0L, 1L, 0L),
    services_single = if_else(services_num_selected == 1L, 1L, 0L),
    services_category = case_when(
      services_prefer_not == 1L ~ "Prefer not to say",
      services_multiple == 1L ~ "Multiple",
      act_team == 1L ~ "ACT Team",
      therapy == 1L ~ "Therapy/Counseling",
      er_services == 1L ~ "Emergency Room",
      inpatient_voluntary == 1L ~ "Inpatient Voluntary",
      inpatient_involuntary == 1L ~ "Inpatient Involuntary",
      medication_mgmt == 1L ~ "Medication Management",
      outpatient_program == 1L ~ "Outpatient Program",
      services_other == 1L ~ "Other",
      TRUE ~ NA_character_
    )
  )

# Exclusive categories (each person counted once)
table(Survey$services_category, useNA = "ifany")

# Explicit count of Multiple service types
num_services_multiple <- sum(Survey$services_multiple == 1L, na.rm = TRUE)
num_services_multiple

# Any-selection counts (people selecting multiple are counted in each selected service)
services_counts <- c(
  ACT_Team = sum(Survey$act_team, na.rm = TRUE),
  Therapy_Counseling = sum(Survey$therapy, na.rm = TRUE),
  Emergency_Room = sum(Survey$er_services, na.rm = TRUE),
  Inpatient_Voluntary = sum(Survey$inpatient_voluntary, na.rm = TRUE),
  Inpatient_Involuntary = sum(Survey$inpatient_involuntary, na.rm = TRUE),
  Medication_Management = sum(Survey$medication_mgmt, na.rm = TRUE),
  Outpatient_Program = sum(Survey$outpatient_program, na.rm = TRUE),
  Other = sum(Survey$services_other, na.rm = TRUE),
  Prefer_not_to_say = sum(Survey$services_prefer_not, na.rm = TRUE)
)
services_counts

# Process free-text responses for service locations (Q19-Q27)
has_q19_to_q27 <- c("Q19", "Q20", "Q21", "Q22", "Q23", "Q24", "Q25", "Q26", "Q27") %in% names(Survey)
Survey <- Survey %>%
  mutate(
    act_team_location = if_else(has_q19_to_q27[1] & !is.na(Q19) & Q19 != "", Q19, NA_character_),
    therapy_location = if_else(has_q19_to_q27[2] & !is.na(Q20) & Q20 != "", Q20, NA_character_),
    er_location = if_else(has_q19_to_q27[3] & !is.na(Q21) & Q21 != "", Q21, NA_character_),
    inpatient_vol_location = if_else(has_q19_to_q27[4] & !is.na(Q22) & Q22 != "", Q22, NA_character_),
    inpatient_invol_location = if_else(has_q19_to_q27[5] & !is.na(Q23) & Q23 != "", Q23, NA_character_),
    medication_location = if_else(has_q19_to_q27[6] & !is.na(Q24) & Q24 != "", Q24, NA_character_),
    outpatient_location = if_else(has_q19_to_q27[7] & !is.na(Q25) & Q25 != "", Q25, NA_character_),
    services_other_detail = if_else(has_q19_to_q27[8] & !is.na(Q26) & Q26 != "", Q26, NA_character_),
    services_other_location = if_else(has_q19_to_q27[9] & !is.na(Q27) & Q27 != "", Q27, NA_character_)
  )

# Summary of service locations (restricted to those who selected each service)
cat("ACT Team locations:\n")
table(Survey$act_team_location[Survey$act_team == 1], useNA = "ifany")
cat("\nTherapy locations:\n")
table(Survey$therapy_location[Survey$therapy == 1], useNA = "ifany")
cat("\nER locations:\n")
table(Survey$er_location[Survey$er_services == 1], useNA = "ifany")
cat("\nOther services detail:\n")
table(Survey$services_other_detail[Survey$services_other == 1], useNA = "ifany")
```
```{r Frequency of accessing mental health services}
Survey <- Survey %>%
  mutate(mh_access_freq = case_when(
    Q28 == "Weekly"  ~ 1,
    Q28== "Monthly"  ~ 2,
    Q28== "Rarely" ~ 3, 
    Q28== "Never" ~4,
    Q28 == "Prefer not to say" ~5,
    TRUE ~ NA_real_
  ))
table(Survey$mh_access_freq, useNA = "ifany")

# of the 68 people that have received care in the past year they accessed mh service: 12-weekly, 24-monthly, 26-rarely, 6-Prefer Not to say
```
```{r Were Services Interupted}
Survey <- Survey%>%
  mutate (services_interupted= case_when(
    Q29 == "Yes" ~1,
    Q29 == "No"  ~2,
    Q29 == "Not sure/prefer not to say" ~3,
    TRUE ~ NA_real_
    ))
table (Survey$services_interupted)
 # 33-yes 34-No 1-Not sure/prefer not to say
```
```{r Causes of Interruption of Care}
unique(Survey$Q31)
Survey <- Survey %>%
  mutate(
    interruption_causes = if_else(is.na(Q31), "", Q31),
    interruption_incarceration = if_else(str_detect(interruption_causes, fixed("Incarceration")), 1L, 0L),
    interruption_poor_connection = if_else(str_detect(interruption_causes, fixed("Poor connection to services from hospital discharge")), 1L, 0L),
    interruption_missed_appointments = if_else(str_detect(interruption_causes, fixed("Unable to keep track of appointments")), 1L, 0L),
    interruption_dropped_by_provider = if_else(str_detect(interruption_causes, fixed("Dropped by provider")), 1L, 0L),
    interruption_lost_meds = if_else(str_detect(interruption_causes, fixed("Lost medications")), 1L, 0L),
    interruption_med_side_effects = if_else(str_detect(interruption_causes, fixed("Didn't like the medications and/or side effects")), 1L, 0L),
    interruption_chose_to_stop = if_else(str_detect(interruption_causes, fixed("Chose to stop services")), 1L, 0L),
    interruption_never_accessed = if_else(str_detect(interruption_causes, fixed("I have never accessed mental healthcare services")), 1L, 0L),
    interruption_prefer_not = if_else(str_detect(interruption_causes, fixed("Not sure/prefer not to say")), 1L, 0L),
    interruption_other = if_else(str_detect(interruption_causes, fixed("Other (please specify)")), 1L, 0L),
    interruption_num_selected = interruption_incarceration + interruption_poor_connection + interruption_missed_appointments + interruption_dropped_by_provider + interruption_lost_meds + interruption_med_side_effects + interruption_chose_to_stop + interruption_never_accessed + interruption_prefer_not + interruption_other,
    interruption_multiple = if_else(interruption_num_selected > 1 & interruption_prefer_not == 0L & interruption_never_accessed == 0L, 1L, 0L),
    interruption_single = if_else(interruption_num_selected == 1L, 1L, 0L),
    interruption_category = case_when(
      interruption_prefer_not == 1L ~ "Prefer not to say",
      interruption_never_accessed == 1L ~ "Never accessed services",
      interruption_multiple == 1L ~ "Multiple causes",
      interruption_incarceration == 1L ~ "Incarceration",
      interruption_poor_connection == 1L ~ "Poor connection from discharge",
      interruption_missed_appointments == 1L ~ "Missed appointments",
      interruption_dropped_by_provider == 1L ~ "Dropped by provider",
      interruption_lost_meds == 1L ~ "Lost medications",
      interruption_med_side_effects == 1L ~ "Medication side effects",
      interruption_chose_to_stop == 1L ~ "Chose to stop",
      interruption_other == 1L ~ "Other",
      TRUE ~ NA_character_
    )
  )

# Exclusive categories (each person counted once)
table(Survey$interruption_category, useNA = "ifany")

# Explicit count of Multiple interruption causes
num_interruption_multiple <- sum(Survey$interruption_multiple == 1L, na.rm = TRUE)
num_interruption_multiple

# Any-selection counts (people selecting multiple are counted in each selected cause)
interruption_counts <- c(
  Incarceration = sum(Survey$interruption_incarceration, na.rm = TRUE),
  Poor_connection_discharge = sum(Survey$interruption_poor_connection, na.rm = TRUE),
  Missed_appointments = sum(Survey$interruption_missed_appointments, na.rm = TRUE),
  Dropped_by_provider = sum(Survey$interruption_dropped_by_provider, na.rm = TRUE),
  Lost_medications = sum(Survey$interruption_lost_meds, na.rm = TRUE),
  Medication_side_effects = sum(Survey$interruption_med_side_effects, na.rm = TRUE),
  Chose_to_stop = sum(Survey$interruption_chose_to_stop, na.rm = TRUE),
  Never_accessed = sum(Survey$interruption_never_accessed, na.rm = TRUE),
  Other = sum(Survey$interruption_other, na.rm = TRUE),
  Prefer_not_to_say = sum(Survey$interruption_prefer_not, na.rm = TRUE)
)
interruption_counts

# Process Q32 (Other interruption causes)
has_q32 <- "Q32" %in% names(Survey)
Survey <- Survey %>%
  mutate(
    interruption_other_detail = case_when(
      has_q32 & !is.na(Q32) & Q32 != "" ~ Q32,
      TRUE ~ NA_character_
    )
  )
# Categorize Q32 (Other interruption causes)
Survey <- Survey %>%
  mutate(
    interruption_other_detail_clean = case_when(
      !is.na(interruption_other_detail) & interruption_other_detail != "" ~ str_squish(str_to_lower(interruption_other_detail)),
      TRUE ~ NA_character_
    ),
    interruption_other_detail_category = case_when(
      !is.na(interruption_other_detail_clean) & str_detect(interruption_other_detail_clean, "homeless|housing|shelter|living situation|address") ~ "Housing instability",
      !is.na(interruption_other_detail_clean) & str_detect(interruption_other_detail_clean, "insurance|medicaid|medicare|coverage|payment|cost|money|financial") ~ "Insurance/Financial",
      !is.na(interruption_other_detail_clean) & str_detect(interruption_other_detail_clean, "transportation|bus|car|ride|distance|location") ~ "Transportation",
      !is.na(interruption_other_detail_clean) & str_detect(interruption_other_detail_clean, "provider|doctor|therapist|staff|personnel|turnover") ~ "Provider issues",
      !is.na(interruption_other_detail_clean) & str_detect(interruption_other_detail_clean, "scheduling|appointment|wait|time|hours") ~ "Scheduling/Access",
      !is.na(interruption_other_detail_clean) & str_detect(interruption_other_detail_clean, "mental health|depression|anxiety|feeling|symptoms") ~ "Mental health related",
      !is.na(interruption_other_detail_clean) & str_detect(interruption_other_detail_clean, "substance|alcohol|drug|addiction") ~ "Substance use",
      !is.na(interruption_other_detail_clean) & interruption_other_detail_clean != "" ~ "Other/unspecified",
      TRUE ~ NA_character_
    )
  )

# Frequency of categorized Other interruption causes
table(Survey$interruption_other_detail_category[Survey$interruption_other == 1], useNA = "ifany")
```

```{r Barriers to Mental Healthcare}
unique(Survey$Q33)
Survey <- Survey %>%
  mutate(
    barriers = if_else(is.na(Q33), "", Q33),
    barrier_insurance = if_else(str_detect(barriers, fixed("Lack of insurance or financial resources")), 1L, 0L),
    barrier_transportation = if_else(str_detect(barriers, fixed("Lack of transportation")), 1L, 0L),
    barrier_stigma = if_else(str_detect(barriers, fixed("Stigma or fear of discrimination")), 1L, 0L),
    barrier_negative_experiences = if_else(str_detect(barriers, fixed("Previous negative experiences within healthcare settings")), 1L, 0L),
    barrier_lack_knowledge = if_else(str_detect(barriers, fixed("Lack of knowledge about available resources or providers")), 1L, 0L),
    barrier_meds_appointments = if_else(str_detect(barriers, fixed("Unable to keep up with medications or appointments")), 1L, 0L),
    barrier_navigation = if_else(str_detect(barriers, fixed("Difficulty navigating the system")), 1L, 0L),
    barrier_prefer_not = if_else(str_detect(barriers, fixed("Not sure/prefer not to say")), 1L, 0L),
    barrier_other = if_else(str_detect(barriers, fixed("Other (please specify)")), 1L, 0L),
    barrier_num_selected = barrier_insurance + barrier_transportation + barrier_stigma + barrier_negative_experiences + barrier_lack_knowledge + barrier_meds_appointments + barrier_navigation + barrier_other + barrier_prefer_not,
    barrier_multiple = if_else(barrier_num_selected > 1 & barrier_prefer_not == 0L, 1L, 0L),
    barrier_single = if_else(barrier_num_selected == 1L, 1L, 0L),
    barrier_category = case_when(
      barrier_prefer_not == 1L ~ "Prefer not to say",
      barrier_multiple == 1L ~ "Multiple barriers",
      barrier_insurance == 1L ~ "Insurance/Financial",
      barrier_transportation == 1L ~ "Transportation",
      barrier_stigma == 1L ~ "Stigma/Discrimination",
      barrier_negative_experiences == 1L ~ "Negative experiences",
      barrier_lack_knowledge == 1L ~ "Lack of knowledge",
      barrier_meds_appointments == 1L ~ "Medications/Appointments",
      barrier_navigation == 1L ~ "System navigation",
      barrier_other == 1L ~ "Other",
      TRUE ~ NA_character_
    )
  )

# Exclusive categories (each person counted once)
table(Survey$barrier_category, useNA = "ifany")

# Explicit count of Multiple barriers
num_barrier_multiple <- sum(Survey$barrier_multiple == 1L, na.rm = TRUE)
num_barrier_multiple

# Any-selection counts (people selecting multiple are counted in each selected barrier)
barrier_counts <- c(
  Insurance_Financial = sum(Survey$barrier_insurance, na.rm = TRUE),
  Transportation = sum(Survey$barrier_transportation, na.rm = TRUE),
  Stigma_Discrimination = sum(Survey$barrier_stigma, na.rm = TRUE),
  Negative_experiences = sum(Survey$barrier_negative_experiences, na.rm = TRUE),
  Lack_of_knowledge = sum(Survey$barrier_lack_knowledge, na.rm = TRUE),
  Medications_Appointments = sum(Survey$barrier_meds_appointments, na.rm = TRUE),
  System_navigation = sum(Survey$barrier_navigation, na.rm = TRUE),
  Other = sum(Survey$barrier_other, na.rm = TRUE),
  Prefer_not_to_say = sum(Survey$barrier_prefer_not, na.rm = TRUE)
)
barrier_counts
#74 people experienced multiple barriers, 6 preferred not to say
#Insurance_Financial-45          Transportation-60  Stigma_Discrimination-27    Negative_experiences-31        Lack_of_knowledge-55   Medications_Appointments-44       System_navigation-41           Other-26        Prefer_not_to_say-6

# Q34 (Other barriers)
has_q34 <- "Q34" %in% names(Survey)
Survey <- Survey %>%
  mutate(
    barrier_other_detail = case_when(
      has_q34 & !is.na(Q34) & Q34 != "" ~ Q34,
      TRUE ~ NA_character_
    ),
    barrier_other_detail_clean = case_when(
      !is.na(barrier_other_detail) & barrier_other_detail != "" ~ str_squish(str_to_lower(barrier_other_detail)),
      TRUE ~ NA_character_
    ),
    barrier_other_detail_category = case_when(
      !is.na(barrier_other_detail_clean) & str_detect(barrier_other_detail_clean, "homeless|housing|shelter|living situation|address|stability") ~ "Housing instability",
      !is.na(barrier_other_detail_clean) & str_detect(barrier_other_detail_clean, "insurance|medicaid|medicare|coverage|payment|cost|money|financial|afford") ~ "Insurance/Financial",
      !is.na(barrier_other_detail_clean) & str_detect(barrier_other_detail_clean, "transportation|bus|car|ride|distance|location|travel") ~ "Transportation",
      !is.na(barrier_other_detail_clean) & str_detect(barrier_other_detail_clean, "provider|doctor|therapist|staff|personnel|turnover|availability") ~ "Provider availability",
      !is.na(barrier_other_detail_clean) & str_detect(barrier_other_detail_clean, "scheduling|appointment|wait|time|hours|availability|capacity") ~ "Scheduling/Access",
      !is.na(barrier_other_detail_clean) & str_detect(barrier_other_detail_clean, "mental health|depression|anxiety|feeling|symptoms|mood|energy") ~ "Mental health symptoms",
      !is.na(barrier_other_detail_clean) & str_detect(barrier_other_detail_clean, "substance|alcohol|drug|addiction|use") ~ "Substance use",
      !is.na(barrier_other_detail_clean) & str_detect(barrier_other_detail_clean, "language|communication|english|spanish|interpreter") ~ "Language/Communication",
      !is.na(barrier_other_detail_clean) & str_detect(barrier_other_detail_clean, "documentation|id|identification|papers|proof") ~ "Documentation/ID",
      !is.na(barrier_other_detail_clean) & str_detect(barrier_other_detail_clean, "family|children|caregiver|support") ~ "Family/Caregiving",
      !is.na(barrier_other_detail_clean) & barrier_other_detail_clean != "" ~ "Other/unspecified",
      TRUE ~ NA_character_
    )
  )

# Frequency of categorized Other barriers (restricted to those who selected Other)
table(Survey$barrier_other_detail_category[Survey$barrier_other == 1], useNA = "ifany")

#Documentation/ID-3    Family/Care giving-1   Housing instability-1    Other/unspecified-14  Provider availability-1     Scheduling/Access-1 Transportation-5
```

```{r Difficulty Accessing Mental Healthcare services}
Survey <- Survey %>%
  mutate(difficulty_accessing = case_when(
    Q35 == "Very easy" ~ 1,
    Q35 == "Easy" ~ 2,
    Q35 == "Neutral" ~ 3,
    Q35 == "Difficult" ~ 4,
    Q35== "Very difficult"~5,
    TRUE ~ NA_real_
  ))
table (Survey$ difficulty_accessing)
# Very easy-14, Easy-15, Neutral-29, Difficult-18, Very Difficult- 24
```

```{r Enough Mental Healthcare Resources}
Survey <- Survey %>%
  mutate(mh_resources_feelings = case_when(
    Q36 == "Strongly agree" ~ 1,
    Q36 == "Somewhat agree" ~ 2,
    Q36 == "Neither agree nor disagree" ~ 3,
    Q36 == "Somewhat disagree" ~ 4,
    Q36== "Strongly disagree"~5,
    TRUE ~ NA_real_
  ))
table (Survey$ mh_resources_feelings)
#Strongly Agree-15, Somewhat agree-19, Neither agree nor disagree-7, Somewhat disagree-17, Strongly disagree-42
```

```{r Support recieved for Community Organizations or Shelters}
Survey<- Survey %>%
  mutate (support= case_when(
    Q37== "Yes"~1,
    Q37== "No"~2,
    Q37== "Not sure/ prefer not to say"~3,
    TRUE~NA_real_

  ))
table (Survey$support)

# Yes-36 No-62
```
```{r Support Recieved}
# Types of Support Received (Q38) - multiselect
unique(Survey$Q38)
Survey <- Survey %>%
  mutate(
    support_types = if_else(is.na(Q38), "", Q38),
    support_food = if_else(str_detect(support_types, fixed("Food")), 1L, 0L),
    support_hygiene = if_else(str_detect(support_types, fixed("Hygiene")), 1L, 0L),
    support_housing = if_else(str_detect(support_types, fixed("Housing assistance")), 1L, 0L),
    support_employment = if_else(str_detect(support_types, fixed("Employment assistance")), 1L, 0L),
    support_case_mgmt = if_else(str_detect(support_types, fixed("Case management")), 1L, 0L),
    support_benefits = if_else(str_detect(support_types, fixed("Assistance applying for benefits")), 1L, 0L),
    support_prefer_not = if_else(str_detect(support_types, fixed("Not sure/prefer not to say")), 1L, 0L),
    support_other = if_else(str_detect(support_types, fixed("Other (please specify)")), 1L, 0L),
    support_num_selected = support_food + support_hygiene + support_housing + support_employment + support_case_mgmt + support_benefits + support_other + support_prefer_not,
    support_multiple = if_else(support_num_selected > 1 & support_prefer_not == 0L, 1L, 0L),
    support_single = if_else(support_num_selected == 1L, 1L, 0L),
    support_category = case_when(
      support_prefer_not == 1L ~ "Prefer not to say",
      support_multiple == 1L ~ "Multiple support types",
      support_food == 1L ~ "Food",
      support_hygiene == 1L ~ "Hygiene",
      support_housing == 1L ~ "Housing assistance",
      support_employment == 1L ~ "Employment assistance",
      support_case_mgmt == 1L ~ "Case management",
      support_benefits == 1L ~ "Benefits assistance",
      support_other == 1L ~ "Other",
      TRUE ~ NA_character_
    )
  )

# Exclusive categories (each person counted once)
table(Survey$support_category, useNA = "ifany")

# Explicit count of Multiple support types
num_support_multiple <- sum(Survey$support_multiple == 1L, na.rm = TRUE)
num_support_multiple

# Any-selection counts (people selecting multiple are counted in each selected support type)
support_counts <- c(
  Food = sum(Survey$support_food, na.rm = TRUE),
  Hygiene = sum(Survey$support_hygiene, na.rm = TRUE),
  Housing_assistance = sum(Survey$support_housing, na.rm = TRUE),
  Employment_assistance = sum(Survey$support_employment, na.rm = TRUE),
  Case_management = sum(Survey$support_case_mgmt, na.rm = TRUE),
  Benefits_assistance = sum(Survey$support_benefits, na.rm = TRUE),
  Other = sum(Survey$support_other, na.rm = TRUE),
  Prefer_not_to_say = sum(Survey$support_prefer_not, na.rm = TRUE)
)
support_counts

# Process and categorize Q39 (Other support types)
has_q39 <- "Q39" %in% names(Survey)
Survey <- Survey %>%
  mutate(
    support_other_detail = case_when(
      has_q39 & !is.na(Q39) & Q39 != "" ~ Q39,
      TRUE ~ NA_character_
    ),
    support_other_detail_clean = case_when(
      !is.na(support_other_detail) & support_other_detail != "" ~ str_squish(str_to_lower(support_other_detail)),
      TRUE ~ NA_character_
    ),
    support_other_detail_category = case_when(
      !is.na(support_other_detail_clean) & str_detect(support_other_detail_clean, "clothing|clothes|dress|shirt|pants|shoes") ~ "Clothing",
      !is.na(support_other_detail_clean) & str_detect(support_other_detail_clean, "transportation|bus|car|ride|ticket|pass") ~ "Transportation",
      !is.na(support_other_detail_clean) & str_detect(support_other_detail_clean, "medical|health|doctor|medication|prescription|treatment") ~ "Medical/Healthcare",
      !is.na(support_other_detail_clean) & str_detect(support_other_detail_clean, "mental health|therapy|counseling|psychiatry|psychologist") ~ "Mental Health Services",
      !is.na(support_other_detail_clean) & str_detect(support_other_detail_clean, "legal|lawyer|attorney|court|justice|advocacy") ~ "Legal assistance",
      !is.na(support_other_detail_clean) & str_detect(support_other_detail_clean, "phone|cell|communication|contact|calling") ~ "Communication",
      !is.na(support_other_detail_clean) & str_detect(support_other_detail_clean, "storage|belongings|stuff|items|personal") ~ "Storage/Belongings",
      !is.na(support_other_detail_clean) & str_detect(support_other_detail_clean, "education|school|training|learning|classes") ~ "Education/Training",
      !is.na(support_other_detail_clean) & str_detect(support_other_detail_clean, "social|companionship|friendship|community|peer") ~ "Social support",
      !is.na(support_other_detail_clean) & str_detect(support_other_detail_clean, "financial|money|cash|assistance|help|aid") ~ "Financial assistance",
      !is.na(support_other_detail_clean) & support_other_detail_clean != "" ~ "Other/unspecified",
      TRUE ~ NA_character_
    )
  )

# Frequency of categorized Other support types (restricted to those who selected Other)
table(Survey$support_other_detail_category[Survey$support_other == 1], useNA = "ifany")
```

